<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŒ· Flor de Namoro ðŸŒ·</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #ffe6eb, #ffd6f3);
      color: #4b004b;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      transition: background 0.5s, color 0.5s;
    }
    body.dark {
      background: linear-gradient(135deg, #1a001a, #330033);
      color: #f8e6f8;
    }
    header {
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2.3em;
      margin-bottom: 0;
    }
    p {
      margin-top: 0;
    }
    .section {
      padding: 20px;
      text-align: center;
    }
    #totalTime, #nextCountdown, #reunionCountdown {
      font-size: 1.2em;
      font-weight: bold;
    }
    #monthProgress {
      height: 10px;
      width: 80%;
      background-color: #ffc0cb;
      border-radius: 10px;
      margin: 10px auto;
      overflow: hidden;
      position: relative;
    }
    #monthProgress .bar {
      background-color: #ff4b8b;
      height: 100%;
      width: 0;
      border-radius: 10px;
      transition: width 0.5s ease;
    }
    .controls button {
      background-color: #ff8ccf;
      border: none;
      border-radius: 12px;
      padding: 10px 18px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
    }
    .controls button:hover {
      transform: scale(1.1);
    }
    .float-thing {
      position: fixed;
      font-size: 22px;
      animation: floatUp 2.6s linear forwards;
    }
    @keyframes floatUp {
      0% {transform: translateY(0) scale(1); opacity: 1;}
      100% {transform: translateY(-100vh) scale(0.6); opacity: 0;}
    }
    #gallery img {
      width: 120px;
      border-radius: 15px;
      margin: 5px;
      cursor: pointer;
      transition: transform 0.3s;
    }
    #gallery img:hover {
      transform: scale(1.1);
    }
    #modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      visibility: hidden;
    }
    #modal[aria-hidden="false"] {
      visibility: visible;
    }
    #modal img {
      width: 90%;
      max-width: 500px;
      border-radius: 15px;
    }
    #modal span {
      position: absolute;
      top: 10px; right: 20px;
      font-size: 2em;
      color: white;
      cursor: pointer;
    }
    #qrcode {
      margin-top: 10px;
    }
    iframe {
      margin-top: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
</head>
<body>
  <header>
    <h1>ðŸ’ž Flor de Namoro ðŸ’ž</h1>
    <p>Vitor & Sarah â€” juntos desde 04/10/2024 ðŸŒ·</p>
  </header>

  <section class="section">
    <div id="totalTime"></div>
    <div id="monthProgress"><div class="bar"></div></div>
    <div id="nextCountdown"></div>
    <div id="reunionCountdown"></div>
  </section>

  <section class="section">
    <h2>ðŸ’Œ Mensagem do Dia</h2>
    <p id="dailyMessage"></p>
    <button id="newDailyBtn">â†» Nova Mensagem</button>
  </section>

  <section class="section">
    <h2>ðŸŽ§ Nossa MÃºsica</h2>
    <!-- Player Spotify incorporado -->
    <iframe style="border-radius:12px"
      src="https://open.spotify.com/embed/track/3KYlOzxN5xO7eEauO1VF06?utm_source=generator"
      width="100%" height="352" frameborder="0"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
      loading="lazy"></iframe>
    <br>
    <button id="showQRBtn">ðŸ“± Mostrar QR Code da MÃºsica</button>
    <div id="qrcode"></div>
  </section>

  <section class="section controls">
    <button id="toggleHeartsBtn">ðŸ’ž Amor sem fim</button>
    <button id="themeToggle">ðŸŒ— Tema</button>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const START_DATE = new Date("2024-10-04T00:00:00");
      const REUNION = new Date("2025-12-25T00:00:00");

      const totalTimeEl = document.getElementById("totalTime");
      const monthProgressEl = document.querySelector("#monthProgress .bar");
      const nextCountdownEl = document.getElementById("nextCountdown");
      const reunionCountdownEl = document.getElementById("reunionCountdown");
      const dailyMessageEl = document.getElementById("dailyMessage");
      const gallery = document.getElementById("gallery");
      const modal = document.getElementById("modal");
      const modalImg = document.getElementById("modalImg");
      const modalClose = document.getElementById("modalClose");
      const modalCaption = document.getElementById("modalCaption");
      const themeToggle = document.getElementById("themeToggle");
      const toggleHeartsBtn = document.getElementById("toggleHeartsBtn");
      const showQRBtn = document.getElementById("showQRBtn");
      const qrcodeEl = document.getElementById("qrcode");

      const dailyPhrases = [
        "Amar Ã© encontrar no outro o lar. ðŸ’•",
        "Cada batida do meu coraÃ§Ã£o leva seu nome. ðŸ’–",
        "Nada Ã© mais bonito que o nosso jeito de sorrir juntos. ðŸŒ·",
        "VocÃª Ã© minha certeza em meio a tudo. ðŸ’ž",
        "Se fosse pra escolher de novo, eu escolheria vocÃª. ðŸ’—"
      ];

      const pad = (num) => num.toString().padStart(2, "0");

      const updateTotalTime = () => {
        const now = new Date();
        const diff = now - START_DATE;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((diff / (1000 * 60)) % 60);
        totalTimeEl.textContent = `ðŸŒ¸ Juntos hÃ¡ ${days} dias, ${hours}h${pad(minutes)}m`;
      };

      const nextDay4Reference = (now) => {
        let year = now.getFullYear();
        let month = now.getMonth();
        let candidate = new Date(year, month, 4);
        if (now.getDate() >= 4) {
          month++;
          if (month > 11) { month = 0; year++; }
          candidate = new Date(year, month, 4);
        }
        return candidate;
      };

      const updateMonthProgress = () => {
        const now = new Date();
        const next = nextDay4Reference(now);
        const last = new Date(next.getFullYear(), next.getMonth() - 1, 4);
        const total = next - last;
        const elapsed = now - last;
        const progress = Math.min(100, Math.max(0, (elapsed / total) * 100));
        monthProgressEl.style.width = `${progress}%`;

        const diffMs = next - now;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        const diffHours = Math.floor((diffMs / (1000 * 60 * 60)) % 24);
        const diffMinutes = Math.floor((diffMs / (1000 * 60)) % 60);
        nextCountdownEl.textContent = `ðŸ’ž PrÃ³ximo mÃªsversÃ¡rio em ${diffDays}d ${pad(diffHours)}:${pad(diffMinutes)}`;
      };

      const updateReunionCountdown = () => {
        const now = new Date();
        const diffMs = REUNION - now;
        if (diffMs <= 0) {
          reunionCountdownEl.textContent = "ðŸŽ„ O reencontro chegou ðŸ’–";
          return;
        }
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        const diffHours = Math.floor((diffMs / (1000 * 60 * 60)) % 24);
        const diffMinutes = Math.floor((diffMs / (1000 * 60)) % 60);
        reunionCountdownEl.textContent = `â³ Reencontro em ${diffDays}d ${pad(diffHours)}:${pad(diffMinutes)}`;
      };

      const getDailyMessage = () => {
        const today = new Date().toDateString();
        const stored = localStorage.getItem("dailyMsg");
        const storedDate = localStorage.getItem("dailyDate");
        if (stored && storedDate === today) return stored;
        const msg = dailyPhrases[Math.floor(Math.random() * dailyPhrases.length)];
        localStorage.setItem("dailyMsg", msg);
        localStorage.setItem("dailyDate", today);
        return msg;
      };
      const refreshDailyMessage = () => { dailyMessageEl.textContent = getDailyMessage(); };
      document.getElementById("newDailyBtn").addEventListener("click", () => {
        localStorage.removeItem("dailyDate");
        refreshDailyMessage();
      });

      // Galeria
      gallery.addEventListener("click", (e) => {
        const img = e.target.closest("img");
        if (!img) return;
        modalImg.src = img.src;
        modalCaption.textContent = img.dataset.caption || "";
        modal.setAttribute("aria-hidden", "false");
      });
      modalClose.addEventListener("click", () => modal.setAttribute("aria-hidden", "true"));
      modal.addEventListener("click", (e) => { if (e.target === modal) modal.setAttribute("aria-hidden", "true"); });

      // Tema
      themeToggle.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
      });
      if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark");

      // CoraÃ§Ãµes
      let heartsActive = false;
      const createHeart = () => {
        if (!heartsActive) return;
        const h = document.createElement("div");
        h.className = "float-thing";
        h.textContent = ["ðŸ’–","ðŸ’ž","ðŸ’“","ðŸ’•"][Math.floor(Math.random() * 4)];
        h.style.left = Math.random() * 100 + "vw";
        h.style.top = "100vh";
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 2600);
      };
      toggleHeartsBtn.addEventListener("click", () => {
        heartsActive = !heartsActive;
        toggleHeartsBtn.textContent = heartsActive ? "ðŸ’— Parar coraÃ§Ãµes" : "ðŸ’ž Amor sem fim";
        if (heartsActive) setInterval(createHeart, 500);
      });

      // QR MÃºsica
      showQRBtn.addEventListener("click", () => {
        qrcodeEl.innerHTML = "";
        new QRCode(qrcodeEl, {
          text: "https://open.spotify.com/track/3KYlOzxN5xO7eEauO1VF06",
          width: 140,
          height: 140,
          colorDark: "#e84a7a",
          colorLight: "#fff",
          correctLevel: QRCode.CorrectLevel.H
        });
      });

      refreshDailyMessage();
      updateTotalTime();
      updateMonthProgress();
      updateReunionCountdown();
      setInterval(() => {
        updateTotalTime();
        updateMonthProgress();
        updateReunionCountdown();
      }, 1000);
    });
  </script>
</body>
</html>
